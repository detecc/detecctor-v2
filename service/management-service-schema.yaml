asyncapi: 2.0.0
info:
  title: Client Management Service
  version: 0.1.0
  description: "Management Service manages the connected clients and access to the plugins."
servers:
  development:
    url: node1.emxq.stockup.site:1883
    protocol: mqtt
    description: Demo EMXQ broker
channels:
  chat/+/auth:
    publish:
      message:
        $ref: '#/components/messages/chatAuthPayload'
  client/+/auth:
    publish:
      message:
        $ref: '#/components/messages/clientAuthPayload'
  client/+/register:
    publish:
      message:
        $ref: '#/components/messages/clientAuthPayload'
  client/+/register/reply:
    subscribe:
      message:
        $ref: '#/components/messages/clientAuthPayload'
  client/+/lang/set:
    publish:
      message:
        $ref: '#/components/messages/clientAuthPayload'
  client/+/plugin/+/execute:
    subscribe:
      message:
        $ref: '#/components/messages/payload'
components:
  messages:
    UserSignedUp:
      payload:
        type: object
        properties:
          displayName:
            type: string
            description: Name of the user
          email:
            type: string
            format: email
            description: Email of the user
    clientAuthPayload:
      payload:
        type: object
        properties:
          serviceNodeKey:
            type: string
            description: ID of the client
          token:
            type: string
            description: Authentication token
    chatAuthPayload:
      payload:
        type: object
        properties:
          chatId:
            type: string
            description: Chat Id
          token:
            type: string
            description: Authentication token
    payload:
      payload:
        type: object
        properties:
          Id:
            type: string
            description: ID of the payload (generated by the service)
          serviceNodeKey:
            type: string
            description: ID of the client
          data:
            type: object
            description: Data
          command:
            type: string
            description: Command name
          success:
            type: boolean
            description: Indicate if there is an error in the payload processing
          error:
            type: string
            description: Detailed description of the error(s)